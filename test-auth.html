<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Autenticación</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6">Test de Autenticación Firebase</h1>
        
        <div id="status" class="mb-4 p-4 bg-gray-100 rounded">
            <p id="statusText">Cargando Firebase...</p>
        </div>

        <div class="space-y-4">
            <button id="testBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                Probar Conexión
            </button>
            
            <button id="loginModalBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                Abrir Modal Login
            </button>
            
            <button id="chatBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                Probar Chat
            </button>
            
            <button id="inboxBtn" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded">
                Probar Buzón
            </button>
        </div>

        <div id="results" class="mt-6 p-4 bg-gray-50 rounded">
            <h3 class="font-semibold mb-2">Resultados:</h3>
            <div id="resultsContent"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCkgz6_Zpu0VOW6GgJxOxd9QlVccsBXnog",
            authDomain: "tcgtrade-7ba27.firebaseapp.com",
            projectId: "tcgtrade-7ba27",
            storageBucket: "tcgtrade-7ba27.firebasestorage.app",
            messagingSenderId: "207150886257",
            appId: "1:207150886257:web:26edebbeb7df7a1d935ad0",
            databaseURL: "https://tcgtrade-7ba27-default-rtdb.europe-west1.firebasedatabase.app"
        };

        let app, auth;
        
        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('statusText');
            statusEl.textContent = message;
            statusEl.className = isError ? 'text-red-600' : 'text-green-600';
        }
        
        function addResult(message) {
            const content = document.getElementById('resultsContent');
            const p = document.createElement('p');
            p.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            p.className = 'text-sm py-1';
            content.appendChild(p);
        }
        
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            updateStatus('✅ Firebase inicializado correctamente');
            
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    addResult(`Usuario conectado: ${user.email}`);
                } else {
                    addResult('No hay usuario conectado');
                }
            });
            
        } catch (error) {
            updateStatus(`❌ Error: ${error.message}`, true);
        }
        
        document.getElementById('testBtn').addEventListener('click', () => {
            addResult('Probando conexión...');
            if (window.showAuthModal) {
                addResult('✅ showAuthModal está disponible');
            } else {
                addResult('❌ showAuthModal NO está disponible');
            }
            
            if (window.showInboxSection) {
                addResult('✅ showInboxSection está disponible');
            } else {
                addResult('❌ showInboxSection NO está disponible');
            }
            
            if (window.chatUI) {
                addResult('✅ chatUI está disponible');
            } else {
                addResult('❌ chatUI NO está disponible');
            }
        });
        
        document.getElementById('loginModalBtn').addEventListener('click', () => {
            addResult('Intentando abrir modal de login...');
            if (window.showAuthModal) {
                window.showAuthModal('login');
                addResult('✅ Modal abierto');
            } else {
                addResult('❌ showAuthModal no está definido');
                // Intentar navegar a la página principal
                window.location.href = '/html/index.html#login';
            }
        });
        
        document.getElementById('chatBtn').addEventListener('click', () => {
            addResult('Probando sistema de chat...');
            if (window.chatUI && window.chatUI.toggleMinimizedBar) {
                window.chatUI.toggleMinimizedBar();
                addResult('✅ Chat toggled');
            } else {
                addResult('❌ Sistema de chat no disponible');
            }
        });
        
        document.getElementById('inboxBtn').addEventListener('click', () => {
            addResult('Probando buzón...');
            if (window.showInboxSection) {
                window.showInboxSection();
                addResult('✅ Buzón abierto');
            } else {
                addResult('❌ showInboxSection no está definido');
                // Intentar navegar a la página principal
                window.location.href = '/html/index.html#inbox';
            }
        });
    </script>
</body>
</html>